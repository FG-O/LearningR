---
title: "Reproducible-document"
author: "rostools"
format: html
---

```{r setup}
#| message: false
#| warning: false

library(tidyverse)
post_meal_data <- read_csv2(here::here("data/post-meal-insulin.csv"))

small_post_meal_data <- select(post_meal_data, id, Age, BMI, Group, auc_pg, auc_ins, glykemi)

tidier_post_meal_data <- small_post_meal_data %>%
  rename(
    auc_glucose = auc_pg,
    auc_insulin = auc_ins
  ) %>%
  filter(glykemi == 0) %>%
  select(-glykemi)

tidied_post_meal_data <- tidier_post_meal_data %>%
  mutate(
    insulin_glucose_ratio = auc_insulin / auc_glucose,
    Group = if_else(Group == "CTR", "Control", "First-degree-relative")
  )
```

crtl + enter kører koden

Man kan altid tilføje kolonner til sit lille datasæt. Husk blot at køre koden igen. 

Husk at få modificerede datasæt i setup chunk, for at sikre at fremtidige koder fungerer på det modificerede datasæt

## Writing R code

2+2 

```{r}
2 + 2
```


## About me

- Freja
- Endokrinologisk Afd. M, Odense Universitetshospital

Jeg arbejder med **skøre** knogler og lægemidlet *alendronat*


## Simple code


```{r}
3 * 3
```
## Testing for Git

I dag er det solskin

```{r}
post_meal_data

glimpse(post_meal_data)
```

## Plot one continuous variable 

```{r}
#| fig-cap: "Distribution of BMI"
#| label: fig-bmi-histo
ggplot(post_meal_data, aes(x = BMI)) +
  geom_histogram()
```
Ved at tilføje Label kan man referere til figuren, f.eks.: See @fig-bmi-histo

## Exercise: discrete plots

```{r}
#| fig-cap: "Glykemi"
#| label: fig-glykemi-bar
ggplot(post_meal_data, aes(x = glykemi)) +
  geom_bar()
```

See @fig-glykemi-bar above for a cool plot!

Ved kontinuerlige variabler kan man plotte to variable.

## Plot two discrete variables

fill kan ikke bruge tal, og i dette tilfælde er glykemi kodet som 0 eller 1, som talværdier. 

```{r}
ggplot(post_meal_data, aes(
  x = Group, fill =
    as.character(glykemi)
)) +
  geom_bar(position = position_dodge())
```

Position position_dodge sætter grupperne ved siden af hinanden.

## Side by side plots 

Navngiver chunk for overblik 
layout-ncol sætter dem ved siden af hinanden, kolonner 

```{r fig-bmi-glycemia}
#| fig-cap: "BMI and glycemia, side by side"
#| fig-subcap:
#|  - "Distribution of BMI"
#|  - "Number of those with glycemia"
#| layout-ncol: 2

ggplot(post_meal_data, aes(x = BMI)) +
  geom_histogram()
ggplot(post_meal_data, aes(x = glykemi)) +
  geom_bar()
```
barplots, søjlediagrammer, fungerer ikke for kontinuerlige variable. Kun til kategoriske. 

## Plotting two continuous variables

```{r}
#| fig-cap: "Scatterplot of BMI and the area under the curve for glucose"
#| label: fig-bmi-auc-pg
ggplot(post_meal_data, aes(x = BMI, y = auc_pg)) +
  geom_point() +
  geom_smooth()
```

Geom_smooth tilføjer tendenslinje

Style active file gør selve koden flottere. 
scale_ og theme_ kan gør plots flottere? 

GitHub giver alle adgang til dine data. OBS sensitive data

Man kan bruge pilene til at huske tidligere kommandoer 

saperlipopette er en pakke, der fungerer som en slags escape room, hvor man kan øve sig i GitHub. 

## Selecting data 

```{r}
select(post_meal_data, Age)

select(post_meal_data, Age, BMI, Weight)

select(post_meal_data, -Group)

select(post_meal_data, starts_with("PG"))

select(post_meal_data, ends_with("DXA"))

select(post_meal_data, contains("0"))
```
Select ændrer ikke data, men blot viser det. 

Start_with tager alle rækker der starter med PG

## Renaming columns

```{r}
small_post_meal_data %>%
  rename(
    auc_glucose = auc_pg,
    auc_insulin = auc_ins
  )
```

pipe funktion: %>% er det samme som |> 
Rename: nyt navn = gammelt navn

rm() sletter variabel FOR EVIGT. Det er en god ide at have script til dannelsen af variablen gemt. 

## Select and rename tasks
```{r}
# Task 1.
post_meal_data |>
  select(contains("OGTT"))

# Task 2.
post_meal_data |>
  select(contains(".."), -contains("..."))

# Task 3.
post_meal_data |>
  rename(
    P.Glucose.minus5.OGTT = P.Glucose..5.OGTT,
    Insulin.minus5.OGTT.X = Insulin..5.OGTT.X
  )

# Task 4.

post_meal_data |>
  select(id, BMI, Length, Weight, Age) |>
  rename(Height = Length)
```

## Filtering data 

ctrl + shift + m = pipe
Husk at bruge dobbelt =, ==

Filter viser kun bestemte data 

```{r}
small_post_meal_data %>%
  filter(glykemi == 1)

small_post_meal_data %>%
  filter(BMI >= 25)

small_post_meal_data %>%
  filter(Group == "CTR")

small_post_meal_data %>%
  filter(Group == "CTR" | BMI >= 25)
```

Når filter bruges: Dobbelttjek at det du får, er det du ønsker. Vær opmærksom på missing values. 

, betyder AND

## Modifying data ¨

rename virker kun på columns
if_else (condition == true condition, replacement, false (ændre hvad du finder til det her)

```{r}
tidier_post_meal_data %>%
  mutate(insulin_glucose_ratio = auc_insulin / auc_glucose)

tidier_post_meal_data %>%
  mutate(
    insulin_glucose_ratio = auc_insulin / auc_glucose,
    Group = if_else(Group == "CTR", "Control", "First-degree-relative")
  )
```

Style - render - commit 7

## Practice with filter and mutate

ctrl + shift + K = render

```{r}
# Task 1.
post_meal_data |>
  filter(BMI >= 25 & BMI <= 40 & Group == "FDR")

# Task 2.
post_meal_data |>
  mutate(
    percent_body_fat = (Fat.mass.DXA / Weight) * 100
  ) |>
  filter(percent_body_fat > 30)
```

## Visualizing with a jitter plot 

Jitter flytter lidt rundt på variablerne, så kategoriske punkter ikke ligger lige ovenpå hinanden. 

geom_jitter   
geom_boxplot 
geom_violin - laver figurer

```{r}
tidied_post_meal_data %>%
  mutate(overweight = if_else(BMI >= 25, "Overweight", "Not overweight")) %>%
  ggplot(aes(x = overweight, y = insulin_glucose_ratio)) +
  geom_jitter()
```

## Plotting three or more variables 


```{r}
tidied_post_meal_data %>%
  filter(BMI < 30) %>%
  mutate(young = if_else(Age < 40, "Young", "Old")) %>%
  ggplot(aes(x = BMI, y = insulin_glucose_ratio, colour = Group)) +
  geom_point() +
  facet_grid(rows = vars(young)) +
  labs(
    x = "Body mass index (BMI)",
    y = "Insulin to glucose ratio"
  )
```

## Make multi-dimensional plots!

```{r}
```{r}
#| label: fig-multidimensional
#| fig-cap: "Two, mult-dimensional plots of our data."
#| fig-subcap:
#|   - "Distribution of percent body fat by group and age category."
#|   - "Relationship between BMI and bone mineral density, split by insulin sensitivity."
#| layout-ncol: 2
# Task 1.
post_meal_data |>
  mutate(
    percent_body_fat = (Fat.mass.DXA / Weight) * 100,
    young = if_else(Age < 40, "Young", "Old")
  ) |>
  ggplot(aes(x = Group, y = percent_body_fat, colour = young)) +
  geom_jitter(width = 0.2)

# Task 2.
post_meal_data |>
  mutate(
    insulin_glucose_ratio = (auc_ins / auc_pg),
    insulin_insensitive = if_else(insulin_glucose_ratio > mean(insulin_glucose_ratio), "Insensitive", "Sensitive")
  ) |>
  ggplot(aes(x = BMI, y = Bone.mineral.DXA, colour = insulin_insensitive)) +
  geom_point() +
  geom_smooth() +
  facet_grid(cols = vars(insulin_insensitive))
```
```

